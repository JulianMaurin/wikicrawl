# Wikipedia

> stubs are programs that simulate the behaviors of software components ([wikipedia](https://en.wikipedia.org/wiki/Test_stub)).

In our case, we are simulating the behavior of the `wikipedia.org` HTTP server.

## Benefits

Throughout the development of the software, the stub offers a reliable service with minimum latency and no rate limiting.
It is require to avoid spamming on [wikipedia.org](http://wikipedia.org) ([by the way](https://donate.wikimedia.org) :wave:).

Later, thanks to this defined and limited dataset, this service will allow us to define the best possible configuration to launch the pipeline in a long run in real conditions.

## Engine

The stub is powered by [WireMock](https://wiremock.org/).

The local instance runs through docker-compose using the official [docker image](https://hub.docker.com/r/wiremock/wiremock).

Check the [docker compose configuration file](/docker-compose.yaml) to be aware of:

- the port mapped to the host to exposed the HTTP server
- the directory mounted to provide stub data (see [Stub data](#stub-data)).

## Stub data generator CLI

The data used by the WireMock docker container are generated by the `wikicrawl.stub` python package ([see code)](/src/stub)).

The package offers a, [click](https://github.com/pallets/click) powered, CLI to run the data generation.

_Notice this package depends to `wikicrawl.crawl` as well as `wikicrawl.workers` ([see requirements](/src/stub/pyproject.toml))._

To play with the CLI, build the [the custom docker image](/Dockerfile.stub) and run the container shell.

Using the [Makefile](/Makefile):

```sh
make generate-stub-data-image-build
# [...]
make generate-stub-data-sh
# [...]
python -m wikicrawl.stub --help
```

## Run stub data generation

The [Makefile](/Makefile) provides a target to generate data easily:

```sh
make generate-stub-data-image-build # if not already built
# [...]
make generate-stub-data
# [...]
```

Overriding params to build a stub containing 100 pages using the [entry point](/docs/ubiquitousLanguage.md#entry-point) "[Test](https://en.wikipedia.org/wiki/Test)":

```sh
make generate-stub-data GENERATE_STUB_DATA_ENTRYPOINT=Test GENERATE_STUB_DATA_PAGE_COUNT=100
```

## Stub data

Stub data are composed of a pair a files per Wikipedia page:

- the HTML page (eg. _`./.stub/__files/Test`_) downloaded from Wikipedia
- the JSON mapping (eg. _`./.stub/mappings/Test.json`_) basic [stub configuration](https://wiremock.org/docs/stubbing/)
